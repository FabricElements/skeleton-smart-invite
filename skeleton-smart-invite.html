<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icons/communication-icons.html">
<link rel="import" href="./icons/app.html">

<dom-module id="skeleton-smart-invite">
  <template>
    <style is="custom-style">
      :host {
        display: block;
      }

      [hidden] {
        display: none !important;
      }

      #phone-icon {
        margin-right: 0.5rem;
      }

      #status-icon {
        margin-left: 0.5rem;
        color: var(--paper-green-500);
      }

      #status-icon[invalid] {
        color: var(--error-color);
      }

      paper-button {
        background-color: var(--paper-blue-a200);
        color: white;
        position: relative;
        bottom: 0.3rem;
        --paper-button: {
          padding: 0.3rem;
        };
      }

      paper-button iron-icon {
        margin-left: 0.8rem;
        transform: rotate(-45deg);
        position: relative;
        bottom: 0.1rem;
      }
    </style>
    <paper-input value="{{value}}"
                 label="[[label]]"
                 type="text"
                 prevent-invalid-input
                 minlength="4"
                 pattern="[[validationPattern]]"
                 error-message="[[errorMessage]]"
                 invalid="{{invalid}}"
                 autocomplete="on"
                 auto-validate
    >
      <iron-icon icon="[[iconType]]" slot="prefix" id="phone-icon"></iron-icon>
      <iron-icon icon="[[iconValidation]]" slot="suffix" hidden$="[[iconHidden]]"
                 invalid$="[[invalid]]" id="status-icon"></iron-icon>
      <paper-button raised slot="suffix" hidden$="[[buttonHidden]]">INVITE
        <iron-icon icon="send"></iron-icon>
      </paper-button>
    </paper-input>
  </template>

  <script>
    /**
     * `skeleton-smart-invite`
     *
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class SkeletonSmartInvite extends Polymer.Element {
      /**
       * @return {string}
       */
      static get is() {
        return 'skeleton-smart-invite';
      }

      /**
       * @return {object}
       */
      static get properties() {
        return {
          label: {
            type: String,
            value: 'Mobile number or email',
          },
          errorMessage: {
            type: String,
            value: 'Invalid phone number',
          },
          value: {
            type: String,
            value: null,
            reflectToAttribute: true,
            notify: true,
            observer: '_valueObserver',
          },
          invalid: {
            type: Boolean,
            value: false,
            reflectToAttribute: true,
            notify: true,
            observer: '_invalidObserver',
          },
          iconHidden: {
            type: Boolean,
            value: true,
            computed: '_hideIcon(value)',
          },
          buttonHidden: {
            type: Boolean,
            value: true,
          },
          iconValidation: {
            type: String,
            value: 'check',
            computed: '_computeValidationIcon(invalid)',
          },
          iconType: {
            type: String,
            value: 'info',
          },
          validationPattern: {
            type: String,
            value: '(?:\\+)([0-9]{1,3})([0-9]{9,10})',
          },
        };
      }

      /**
       * Validation icon
       *
       * @param {boolean} status
       * @return {string}
       * @private
       */
      _computeValidationIcon(status) {
        return status ? 'close' : 'check';
      }

      /**
       * Hide icon
       *
       * @param {string} text
       * @return {boolean}
       * @private
       */
      _hideIcon(text) {
        return !text;
      }

      /**
       * Hide button
       *
       * @param {string} text
       * @return {boolean}
       * @private
       */
      _hideButton(text) {
        return !text;
      }

      _valueObserver(value) {
        let isValidPhone = false;
        let isValidEmail = false;
        if (!value) return;
        if (value.length < 3) {
          this.iconType = 'info';
        }
        isValidPhone = this._validatePhone(value);
        if (isValidPhone) {
          this.iconType = 'communication:phone';
          return isValidPhone;
        }
        isValidEmail = this._validateEmail(value);
        if (isValidEmail) {
          this.iconType = 'communication:email';
          return isValidEmail;
        }
        return false;
      }

      _validateEmail(text) {
        let re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(text);
      }

      _validatePhone(text) {
        let re = /^\+?([0-9]{3})\)?[ ]?([0-9]{3})[ ]?([0-9]{3})[ ]?([0-9]{3})$/;
        return re.test(text);
      }
    }

    window.customElements.define(SkeletonSmartInvite.is, SkeletonSmartInvite);
  </script>
</dom-module>
